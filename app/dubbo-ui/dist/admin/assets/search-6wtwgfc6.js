import{d as T,k as C,b as V,u as A,r as P,w as D,f as u,c as h,t as c,h as y,P as Q,M as $,e as f,o as n,F as g,z as l,B as d,J as b,I as B,v as S,y as E,K as x,m as M,_ as O}from"./index-nw_d5X0a.js";import{s as F}from"./service-WvA5onH6.js";import{S as L,a as J}from"./SearchUtil-xjq24Jx3.js";import{p as K,q as p}from"./PromQueryUtil-RxWTbbIi.js";import"./request-hwqjhTR7.js";const Y={class:"__container_services_index"},z=["onClick"],H=T({__name:"search",setup(j){C(e=>({"0ff9c544":y(Q)}));const G=V(),v=A();let k=v.query.query;const w=[{title:"service",key:"service",dataIndex:"serviceName",sorter:!0,width:"30%",ellipsis:!0},{title:"versionGroup",key:"versionGroup",dataIndex:"versionGroupSelect",width:"25%"},{title:"avgQPS",key:"avgQPS",dataIndex:"avgQPS",sorter:!0,width:"15%"},{title:"avgRT",key:"avgRT",dataIndex:"avgRT",sorter:!0,width:"15%"},{title:"requestTotal",key:"requestTotal",dataIndex:"requestTotal",sorter:!0,width:"15%"}],_=e=>e.map(r=>(r.versionGroupSelect={},r.versionGroupSelect.versionGroupArr=r.versionGroups.map(a=>a.versionGroup=(a.version?"version: "+a.version+", ":"")+(a.group?"group: "+a.group:"")||"æ— "),r.versionGroupSelect.versionGroupValue=r.versionGroupSelect.versionGroupArr[0],r));function q(e,r){return F(e).then(async a=>K(a,["avgQPS","avgRT","requestTotal"],async s=>{s.avgQPS=await p(`sum (dubbo_provider_qps_total{interface='${s.serviceName}'}) by (interface)`),s.avgRT=await p(`avg(dubbo_consumer_rt_avg_milliseconds_aggregate{interface="${s.serviceName}",method=~"$method"}>0)`),s.requestTotal=await p(`sum (increase(dubbo_provider_requests_total{interface="${s.serviceName}"}[1m]))`)}))}const t=P(new L([{label:"serviceName",param:"keywords",placeholder:"typeAppName",defaultValue:k,style:{width:"200px"}}],q,w,void 0,void 0,_));t.onSearch(_);const I=(e,r)=>{G.push({path:`/resources/services/distribution/${e}`})};return $(M.SEARCH_DOMAIN,t),D(v,(e,r)=>{t.queryForm.keywords=e.query.query,t.onSearch(),console.log(e)}),(e,r)=>{const a=f("a-select-option"),s=f("a-select");return n(),u("div",Y,[h(J,{"search-domain":t},{bodyCell:c(({column:m,record:N,text:o})=>[m.dataIndex==="serviceName"?(n(),u(g,{key:0},[l(d(N.versionGroup)+" ",1),b("span",{class:"service-link",onClick:i=>I(o,o.versionGroupValue)},[b("b",null,[h(y(B),{style:{"margin-bottom":"-2px"},icon:"material-symbols:attach-file-rounded"}),l(" "+d(o),1)])],8,z)],64)):m.dataIndex==="versionGroupSelect"?(n(),S(s,{key:1,value:o==null?void 0:o.versionGroupValue,bordered:!1,style:{width:"80%"}},{default:c(()=>[(n(!0),u(g,null,E(o==null?void 0:o.versionGroupArr,(i,R)=>(n(),S(a,{value:i,key:R},{default:c(()=>[l(d(i),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value"])):x("",!0)]),_:1},8,["search-domain"])])}}}),re=O(H,[["__scopeId","data-v-d6f50869"]]);export{re as default};
